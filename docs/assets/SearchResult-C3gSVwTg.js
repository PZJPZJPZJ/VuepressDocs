import{u as j,e as te,f as le,g as _,h as se,P as ae,t as ue,i as ie,j as P,k as S,l as re,w as Y,m as l,n as oe,R as T,p as ne,q as ce,v as de,C as he,x as ve,y as pe,z as me,A as ye,B as ge,D as fe,E as Re,F as U,G as B,H as He,I as x,J as ke}from"./app-C3tLQS3U.js";const we=["/","/guide/Alist.html","/guide/Android%20Debug%20Bridge.html","/guide/Aria2.html","/guide/BMBF.html","/guide/Bootmgr.html","/guide/Chrome.html","/guide/Clash.html","/guide/ComfyUI.html","/guide/DmitriRender.html","/guide/Docker.html","/guide/Duplicati.html","/guide/ESXi.html","/guide/Everything.html","/guide/Git.html","/guide/Immich.html","/guide/JaNetfilter.html","/guide/John%20the%20Ripper.html","/guide/Lucky.html","/guide/Microsoft%20Activation%20Scripts.html","/guide/Mihomo.html","/guide/MySQL.html","/guide/NextTrace.html","/guide/OpenEUICC.html","/guide/Parsec%20Virtual%20Display.html","/guide/PSP%20Infinity.html","/guide/Redpill%20Recovery.html","/guide/TVBox.html","/guide/Unlock%20Music.html","/guide/Windows.html","/guide/XMind.html","/guide/Xray%20UI.html","/guide/Yuzu.html","/note/SEO.html","/404.html"],Qe="SEARCH_PRO_QUERY_HISTORY",g=j(Qe,[]),Se=()=>{const{queryHistoryCount:s}=x,a=s>0;return{enabled:a,queryHistory:g,addQueryHistory:u=>{a&&(g.value=Array.from(new Set([u,...g.value.slice(0,s-1)])))},removeQueryHistory:u=>{g.value=[...g.value.slice(0,u),...g.value.slice(u+1)]}}},b=s=>we[s.id]+("anchor"in s?`#${s.anchor}`:""),xe="SEARCH_PRO_RESULT_HISTORY",{resultHistoryCount:$}=x,f=j(xe,[]),Ce=()=>{const s=$>0;return{enabled:s,resultHistory:f,addResultHistory:a=>{if(s){const u={link:b(a),display:a.display};"header"in a&&(u.header=a.header),f.value=[u,...f.value.slice(0,$-1)]}},removeResultHistory:a=>{f.value=[...f.value.slice(0,a),...f.value.slice(a+1)]}}},qe=s=>{const a=he(),u=_(),C=ve(),r=P(0),k=S(()=>r.value>0),p=pe([]);return me(()=>{const{search:m,terminate:q}=ye(),R=He(c=>{const H=c.join(" "),{searchFilter:D=v=>v,splitWord:A,suggestionsFilter:F,...y}=a.value;H?(r.value+=1,m(c.join(" "),u.value,y).then(v=>D(v,H,u.value,C.value)).then(v=>{r.value-=1,p.value=v}).catch(v=>{console.warn(v),r.value-=1,r.value||(p.value=[])})):p.value=[]},x.searchDelay-x.suggestDelay);Y([s,u],([c])=>R(c),{immediate:!0}),ge(()=>{q()})}),{isSearching:k,results:p}};var Ae=te({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(s,{emit:a}){const u=le(),C=_(),r=se(ae),{enabled:k,addQueryHistory:p,queryHistory:m,removeQueryHistory:q}=Se(),{enabled:R,resultHistory:c,addResultHistory:H,removeResultHistory:D}=Ce(),A=k||R,F=ue(s,"queries"),{results:y,isSearching:v}=qe(F),i=ie({isQuery:!0,index:0}),d=P(0),h=P(0),M=S(()=>A&&(m.value.length>0||c.value.length>0)),E=S(()=>y.value.length>0),L=S(()=>y.value[d.value]||null),J=()=>{const{isQuery:e,index:t}=i;t===0?(i.isQuery=!e,i.index=e?c.value.length-1:m.value.length-1):i.index=t-1},V=()=>{const{isQuery:e,index:t}=i;t===(e?m.value.length-1:c.value.length-1)?(i.isQuery=!e,i.index=0):i.index=t+1},X=()=>{d.value=d.value>0?d.value-1:y.value.length-1,h.value=L.value.contents.length-1},z=()=>{d.value=d.value<y.value.length-1?d.value+1:0,h.value=0},G=()=>{h.value<L.value.contents.length-1?h.value+=1:z()},N=()=>{h.value>0?h.value-=1:X()},I=e=>e.map(t=>ke(t)?t:l(t[0],t[1])),W=e=>{if(e.type==="customField"){const t=fe[e.index]||"$content",[o,Q=""]=Re(t)?t[C.value].split("$content"):t.split("$content");return e.display.map(n=>l("div",I([o,...n,Q])))}return e.display.map(t=>l("div",I(t)))},w=()=>{d.value=0,h.value=0,a("updateQuery",""),a("close")},K=()=>k?l("ul",{class:"search-pro-result-list"},l("li",{class:"search-pro-result-list-item"},[l("div",{class:"search-pro-result-title"},r.value.queryHistory),m.value.map((e,t)=>l("div",{class:["search-pro-result-item",{active:i.isQuery&&i.index===t}],onClick:()=>{a("updateQuery",e)}},[l(U,{class:"search-pro-result-type"}),l("div",{class:"search-pro-result-content"},e),l("button",{class:"search-pro-remove-icon",innerHTML:B,onClick:o=>{o.preventDefault(),o.stopPropagation(),q(t)}})]))])):null,Z=()=>R?l("ul",{class:"search-pro-result-list"},l("li",{class:"search-pro-result-list-item"},[l("div",{class:"search-pro-result-title"},r.value.resultHistory),c.value.map((e,t)=>l(T,{to:e.link,class:["search-pro-result-item",{active:!i.isQuery&&i.index===t}],onClick:()=>{w()}},()=>[l(U,{class:"search-pro-result-type"}),l("div",{class:"search-pro-result-content"},[e.header?l("div",{class:"content-header"},e.header):null,l("div",e.display.map(o=>I(o)).flat())]),l("button",{class:"search-pro-remove-icon",innerHTML:B,onClick:o=>{o.preventDefault(),o.stopPropagation(),D(t)}})]))])):null;return re("keydown",e=>{if(s.isFocusing){if(E.value){if(e.key==="ArrowUp")N();else if(e.key==="ArrowDown")G();else if(e.key==="Enter"){const t=L.value.contents[h.value];p(s.queries.join(" ")),H(t),u.push(b(t)),w()}}else if(R){if(e.key==="ArrowUp")J();else if(e.key==="ArrowDown")V();else if(e.key==="Enter"){const{index:t}=i;i.isQuery?(a("updateQuery",m.value[t]),e.preventDefault()):(u.push(c.value[t].link),w())}}}}),Y([d,h],()=>{var e;(e=document.querySelector(".search-pro-result-list-item.active .search-pro-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>l("div",{class:["search-pro-result-wrapper",{empty:s.queries.length?!E.value:!M.value}],id:"search-pro-results"},s.queries.length?v.value?l(oe,{hint:r.value.searching}):E.value?l("ul",{class:"search-pro-result-list"},y.value.map(({title:e,contents:t},o)=>{const Q=d.value===o;return l("li",{class:["search-pro-result-list-item",{active:Q}]},[l("div",{class:"search-pro-result-title"},e||r.value.defaultTitle),t.map((n,ee)=>{const O=Q&&h.value===ee;return l(T,{to:b(n),class:["search-pro-result-item",{active:O,"aria-selected":O}],onClick:()=>{p(s.queries.join(" ")),H(n),w()}},()=>[n.type==="text"?null:l(n.type==="title"?ne:n.type==="heading"?ce:de,{class:"search-pro-result-type"}),l("div",{class:"search-pro-result-content"},[n.type==="text"&&n.header?l("div",{class:"content-header"},n.header):null,l("div",W(n))])])})])})):r.value.emptyResult:A?M.value?[K(),Z()]:r.value.emptyHistory:r.value.emptyResult)}});export{Ae as default};
